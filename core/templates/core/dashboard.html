{% load i18n %}

{% load static %}
<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <script src="{% static 'core/js/app.js' %}"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard | Co-operative Finance Bank</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Custom CSS (if any) -->
    <link rel="stylesheet" href="{% static 'core/css/style.css' %}">
</head>

<body class="bg-slate-100 dark:bg-slate-900 transition-colors duration-300">

<div class="min-h-screen flex bg-slate-100 dark:bg-slate-900 transition-colors duration-300">

  <!-- SIDEBAR -->
  <aside id="sidebar" class="w-64 bg-blue-950 text-slate-200 fixed md:static inset-y-0 left-0 transform -translate-x-full md:translate-x-0 transition-transform duration-300 z-40">
    <div class="p-6 text-xl font-bold text-yellow-400">
      Co-operative Finance Bank
    </div>
    <nav class="space-y-2 px-4">
      <a href="#" class="sidebar-link" onclick="showSection('profile');closeSidebarOnMobile()">Profile</a>
      <a href="#" class="sidebar-link" onclick="showSection('dashboard');closeSidebarOnMobile()" data-i18n="dashboard">Dashboard</a>
      <a href="#" class="sidebar-link" onclick="showSection('accounts');closeSidebarOnMobile()" data-i18n="accounts">Accounts</a>
      <a href="#" class="sidebar-link" onclick="showSection('transfers');closeSidebarOnMobile()" data-i18n="transfers">Transfers</a>
      <a href="#" class="sidebar-link" onclick="showSection('cards');closeSidebarOnMobile()" data-i18n="cards">Cards</a>
      <a href="#" class="sidebar-link" onclick="showSection('transactions');closeSidebarOnMobile()" data-i18n="transactions">Transactions</a>
      <a href="#" class="sidebar-link" onclick="showSection('security');closeSidebarOnMobile()" data-i18n="security">Security</a>
      <a href="#" class="sidebar-link" onclick="showSection('settings');closeSidebarOnMobile()" data-i18n="settings">Settings</a>
      <form method="post" action="{% url 'logout' %}" style="margin:0;">
        {% csrf_token %}
        <button type="submit" class="sidebar-link text-red-400 font-bold w-full text-left" style="background:none;border:none;padding:0;">Logout</button>
      </form>
    </nav>
  </aside>

  <!-- MAIN CONTENT -->
  <div class="flex-1 md:ml-64">

    <!-- TOP NAV -->
    <header class="bg-white dark:bg-slate-800 shadow flex justify-between items-center px-6 py-4">
      <button onclick="toggleSidebar()" class="md:hidden text-2xl" aria-label="Open menu">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-blue-900 dark:text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
      </button>
      <div class="flex items-center gap-4">
        <!-- Dark Mode Toggle -->
        <button onclick="toggleTheme()" class="bg-slate-200 dark:bg-slate-700 px-3 py-1 rounded-lg text-sm flex items-center gap-2" aria-label="Toggle dark mode">
          <svg id="icon-sun" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="display:none;"><circle cx="12" cy="12" r="5" /><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" /></svg>
          <svg id="icon-moon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-900 dark:text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M21 12.79A9 9 0 1111.21 3a7 7 0 109.79 9.79z" /></svg>
          <span class="hidden md:inline">Dark Mode</span>
        </button>
        <!-- Notifications -->
        <button onclick="showNotifications()" class="relative" aria-label="Show notifications">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-900 dark:text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" /></svg>
          <span class="absolute -top-1 -right-1 bg-yellow-400 text-xs px-1 rounded-full">!</span>
        </button>
      </div>
    </header>

    <!-- DASHBOARD BODY -->
    <main class="p-6 space-y-8">
      <!-- PROFILE SECTION -->
      <div id="section-profile" style="display:none;">
        <div class="bg-white dark:bg-slate-800 rounded-xl shadow p-6 max-w-xl mx-auto">
          <h2 class="text-2xl font-bold mb-4 text-blue-900">Profile</h2>
          {% if profile %}
          <div class="flex flex-col md:flex-row gap-6 items-center">
            <div>
              {% if profile.passport %}
                <img src="{{ profile.passport.url }}" alt="Passport" class="w-32 h-32 object-cover rounded-lg border mb-4">
              {% else %}
                <div class="w-32 h-32 flex items-center justify-center bg-slate-200 rounded-lg border mb-4 text-slate-400">No Image</div>
              {% endif %}
            </div>
            <div class="flex-1 space-y-2">
              <div><span class="font-semibold">Account Number:</span> {{ profile.account_number }}</div>
              <div><span class="font-semibold">First Name:</span> {{ profile.user.first_name }}</div>
              <div><span class="font-semibold">Middle Name:</span> {{ profile.user.last_name }}</div>
              <div><span class="font-semibold">Last Name:</span> {{ profile.user.last_name }}</div>
              <div><span class="font-semibold">Phone:</span> {{ profile.phone }}</div>
              <div><span class="font-semibold">Email:</span> {{ profile.user.email }}</div>
              <div><span class="font-semibold">House Address:</span> {{ profile.address }}</div>
              <div><span class="font-semibold">Nationality:</span> {{ profile.country }}</div>
            </div>
          </div>
          {% else %}
          <div class="text-red-400">No profile found.</div>
          {% endif %}
        </div>
      </div>

      <!-- DASHBOARD SECTION -->
      <div id="section-dashboard">
        <!-- BALANCE CARD -->
        <div class="bg-gradient-to-r from-blue-900 to-blue-800 text-white rounded-2xl p-8 shadow-xl">
          <h2 class="text-yellow-300 text-sm uppercase" data-i18n="available_balance">Available Balance</h2>
          <div class="flex items-center gap-4 mt-2">
            {% if profile %}
            <span id="balance" class="text-4xl font-bold">${{ profile.balance|floatformat:2 }}</span>
            {% if messages %}
              {% for message in messages %}
                {% if 'Transferred' in message %}
                  <span class="ml-4 text-green-400 text-2xl">&#10003; Transfer successful!</span>
                {% endif %}
              {% endfor %}
            {% endif %}
            {% else %}
            <span id="balance" class="text-4xl font-bold text-red-400" data-i18n="no_profile">No profile found</span>
            {% endif %}
          </div>
          <div class="mt-4 flex items-center gap-3">
            <span id="acct" class="tracking-widest">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 8921</span>
            <button onclick="toggleAccount()">üëÅ</button>
          </div>
        </div>
        <!-- ACTION BUTTONS -->
        <div class="grid md:grid-cols-2 gap-6">
          <button onclick="openSend()" class="action-card" data-i18n="send_money">
            Send Money
          </button>
          <button class="action-card bg-yellow-400 text-blue-900 hover:bg-yellow-300" data-i18n="receive_money">
            Receive Money
          </button>
        </div>
      </div>

      <!-- TRANSACTIONS SECTION -->
      <div id="section-transactions" style="display:none;">
        <div class="bg-white dark:bg-slate-800 rounded-xl shadow p-6">
          <div class="flex justify-between items-center mb-4">
            <h3 class="font-semibold text-lg" data-i18n="transactions_title">Transactions</h3>
            <input id="search" onkeyup="filterTx()" placeholder="Search..." class="border px-3 py-2 rounded-lg dark:bg-slate-700" data-i18n="search">
          </div>
          <ul id="txList" class="space-y-3 text-sm">
            <!-- Example transactions, replace with Django context if needed -->
            <li class="tx-item">ATM Withdrawal - $200</li>
            <li class="tx-item">Salary Credit +$3,000</li>
            <li class="tx-item">Online Purchase - $120</li>
            <li class="tx-item">Transfer Received +$800</li>
          </ul>
          <div id="noTxMsg" class="text-center text-slate-400 mt-6 hidden" data-i18n="no_transactions">No transactions yet.</div>
        </div>
      </div>
    </main>
  </div>
</div>

<!-- SEND MONEY MODAL -->
<div id="sendModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
  <div class="bg-white dark:bg-slate-800 p-6 rounded-xl w-96 animate-slideUp">
    <h3 class="text-lg font-bold mb-4" data-i18n="send_money_title">Send Money</h3>
    <form method="post" action="" id="sendMoneyForm">
      {% csrf_token %}
      <input name="recipient_account" placeholder="Recipient Account" class="input" required data-i18n="recipient_account">
      <input name="amount" type="number" step="0.01" placeholder="Amount ($)" class="input" required data-i18n="amount">
      <input name="description" placeholder="Description" class="input" data-i18n="description">
      <input name="transfer_pin" type="password" placeholder="Transfer PIN" class="input" required data-i18n="transfer_pin">
      <div class="flex gap-3 mt-4">
        <button type="button" onclick="closeSend()" class="w-1/2 btn-secondary" data-i18n="cancel">Cancel</button>
        <button type="submit" class="w-1/2 btn-primary" data-i18n="send">Send</button>
      </div>
    </form>
    <div id="transferSuccess" style="display:none;" class="flex items-center justify-center mt-4 text-green-600 font-bold">
      <span style="font-size:2rem;">&#10003;</span> <span data-i18n="transfer_success">Transfer successful!</span>
    </div>
    {% if messages %}
      {% for message in messages %}
        {% if 'Transferred' in message %}
          <script>
            document.getElementById('transferSuccess').style.display = 'flex';
            setTimeout(function() {
              closeSend();
              document.getElementById('sendMoneyForm').reset();
              document.getElementById('transferSuccess').style.display = 'none';
            }, 2000);
          </script>
        {% endif %}
      {% endfor %}
    {% endif %}
  </div>
</div>

<!-- KYC POPUP -->
<div id="kyc" class="fixed bottom-6 right-6 bg-white dark:bg-slate-800 p-5 rounded-xl shadow-xl hidden animate-slideUp">
  <h4 class="font-bold mb-1" data-i18n="complete_kyc">Complete KYC</h4>
  <p class="text-sm mb-3" data-i18n="increase_limits">Increase your transfer limits.</p>
  <button class="btn-primary w-full" data-i18n="verify_now">Verify Now</button>
</div>

<!-- Google Translate widget -->
<div id="google_translate_element" style="height:0;width:0;overflow:hidden;"></div>
<script type="text/javascript">
  function googleTranslateElementInit() {
    new google.translate.TranslateElement({pageLanguage: 'en', includedLanguages: 'en,fr,es,pt,ko,tr,ru,zh,pl,it,ky'}, 'google_translate_element');
  }
</script>
<script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
<script>
  const langMap = {en:'en',fr:'fr',es:'es',pt:'pt',ko:'ko',tr:'tr',ru:'ru',zh:'zh-CN',pl:'pl',it:'it',ky:'ky'};
  function clearGoogleCookies() {
    document.cookie.split(';').forEach(function(c) {
      if (c.trim().startsWith('googtrans=')) {
        document.cookie = c.trim().replace(/^.*(?==)/, '') + '=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/';
      }
    });
  }
  function triggerGoogleTranslate(lang) {
    var select = document.querySelector('select.goog-te-combo');
    if (select) {
      var googleLang = langMap[lang] || 'en';
      select.value = googleLang;
      select.dispatchEvent(new Event('input', { bubbles: true }));
      select.dispatchEvent(new Event('change', { bubbles: true }));
    }
  }
  window.addEventListener('DOMContentLoaded', function() {
    clearGoogleCookies();
    var lang = localStorage.getItem('lang') || 'en';
    var attempts = 0;
    var maxAttempts = 30;
    var interval = setInterval(function() {
      triggerGoogleTranslate(lang);
      var select = document.querySelector('select.goog-te-combo');
      var googleLang = langMap[lang] || 'en';
      if (select && select.value === googleLang) clearInterval(interval);
      attempts++;
      if (attempts >= maxAttempts) clearInterval(interval);
    }, 300);
  });
</script>

<!-- JS -->
<script>
function showSection(section) {
  const sections = [
    'profile',
    'dashboard',
    'accounts',
    'transfers',
    'cards',
    'transactions',
    'security',
    'settings'
  ];
  sections.forEach(s => {
    const el = document.getElementById('section-' + s);
    if (el) el.style.display = (s === section) ? '' : 'none';
  });
}
let showAcc = false;

function toggleAccount() {
  const acc = document.getElementById("acct");
  showAcc = !showAcc;
  acc.textContent = showAcc ? "9876 5432 1098 8921" : "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 8921";
}

function toggleSidebar() {
  document.getElementById("sidebar").classList.toggle("-translate-x-full");
}

function closeSidebarOnMobile() {
  if (window.innerWidth < 768) {
    document.getElementById("sidebar").classList.add("-translate-x-full");
  }
}

function openSend() {
  document.getElementById("sendModal").classList.remove("hidden");
  document.getElementById("sendModal").classList.add("flex");
}

function closeSend() {
  document.getElementById("sendModal").classList.add("hidden");
}

function toggleTheme() {
  document.documentElement.classList.toggle('dark');
  // Show correct icon
  document.getElementById('icon-sun').style.display = document.documentElement.classList.contains('dark') ? 'block' : 'none';
  document.getElementById('icon-moon').style.display = document.documentElement.classList.contains('dark') ? 'none' : 'block';
}

function showNotifications() {
  alert('No new notifications.'); // Replace with real notification logic if needed
}

// On load, set correct icon
window.addEventListener('DOMContentLoaded', function() {
  document.getElementById('icon-sun').style.display = document.documentElement.classList.contains('dark') ? 'block' : 'none';
  document.getElementById('icon-moon').style.display = document.documentElement.classList.contains('dark') ? 'none' : 'block';
});

function filterTx() {
  const q = document.getElementById("search").value.toLowerCase();
  document.querySelectorAll(".tx-item").forEach(item => {
    item.style.display = item.textContent.toLowerCase().includes(q) ? "" : "none";
  });
}

setInterval(() => {
  const kyc = document.getElementById("kyc");
  kyc.classList.toggle("hidden");
  setTimeout(() => kyc.classList.add("hidden"), 4000);
}, 15000);
</script>

<!-- STYLES -->
<style>
.sidebar-link {
  display:block;
  padding:10px;
  border-radius:8px;
  transition:.3s;
}
.sidebar-link:hover {
  background:#1e3a8a;
  color:#facc15;
}
.action-card {
  padding:20px;
  background:#0f172a;
  color:white;
  border-radius:14px;
  font-weight:600;
  transition:.3s;
}
.action-card:hover {
  transform:translateY(-2px);
  background:#1e40af;
}
.input {
  width:100%;
  padding:10px;
  border-radius:8px;
  border:1px solid #ccc;
  margin-bottom:10px;
}
.btn-primary {
  background:#1e40af;
  color:white;
  padding:10px;
  border-radius:8px;
}
.btn-secondary {
  background:#e5e7eb;
  padding:10px;
  border-radius:8px;
}
@keyframes slideUp {
  from {opacity:0; transform:translateY(20px)}
  to {opacity:1; transform:translateY(0)}
}
.animate-slideUp { animation:.4s slideUp forwards }
</style>




</body>
<!-- Smartsupp Live Chat script -->
<script>
var _smartsupp = _smartsupp || {};
_smartsupp.key = '7a25cc060d5d2575411c7051bae4cf443c5b6134';
window.smartsupp||(function(d) {
  var s,c,o=smartsupp=function(){ o._.push(arguments)};o._=[];
  s=d.getElementsByTagName('script')[0];c=d.createElement('script');
  c.type='text/javascript';c.charset='utf-8';c.async=true;
  c.src='https://www.smartsuppchat.com/loader.js?';s.parentNode.insertBefore(c,s);
})(document);
</script>
</body>
</html>
